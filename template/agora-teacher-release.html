<!DOCTYPE html>
<html lang="en" style="height:100%">
<head>
    <meta charset="UTF-8">
    <title>getmessage</title>
</head>
<body style="height:100%;margin:0;padding:0">
    <script>
        //iframe接收消息，并把当前颜色发送给主页面
        window.onload = () => {
            let btn = document.querySelector('#btn')
            btn.onclick = () => {
                let iframe = document.querySelector('#agoraproxy')
                let roomUuid = document.querySelector('#roomUuid').value


                const courseWareList = JSON.parse(`[{\"resourceName\":\"todo:课件名\",\"resourceUuid\":\"75704928_109133\",\"ext\":\"pptx\",\"url\":\"\",\"conversion\":{\"type\":\"dynamic\"},\"size\":13,\"updateTime\":0,\"scenes\":[{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/1.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 1\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/2.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 2\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/3.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 3\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/4.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 4\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/5.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 5\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/6.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 6\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/7.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 7\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/8.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 8\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/9.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 9\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/10.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 10\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/11.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 11\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/12.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 12\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/13.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 13\"}],\"convert\":true,\"taskUuid\":\"97387cd0ec2811ea83a68f3545d7926d\",\"taskToken\":null,\"taskProgress\":{\"totalPageSize\":13,\"convertedPageSize\":13,\"convertedPercentage\":100,\"convertedFileList\":[{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/1.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 1\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/2.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 2\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/3.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 3\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/4.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 4\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/5.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 5\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/6.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 6\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/7.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 7\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/8.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 8\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/9.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 9\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/10.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 10\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/11.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 11\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/12.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 12\"},{\"ppt\":{\"src\":\"pptx://cover.herewhite.com//dynamicConvert/97387cd0ec2811ea83a68f3545d7926d/13.slide\",\"width\":1890,\"height\":1058},\"name\":\"Scene 13\"}]}}]`)

                // let opts = JSON.parse(`{"userUuid":"UID_10018690","rtmToken":"006d2931ea1715c4bc9b36608770bcf6d01IACRFrBvPbW6JM3XD/GDgAUm0TFF2T3pcogFNP+VapSmzTlLOSEAAAAAEADFnn1JmTFOYAEA6AOpfUxg","rtmUid":"10018690","userName":"声网1","roomUuid":"09fe42f080bb11ebb1a3d35074fec6fb2","roleType":2,"roomType":0,"roomName":"75702143","language":"zh","translateLanguage":"auto","courseWareList":,"duration":1500,"pretest":true}`)

                const teachers = [
                    {userUuid: "teacher01", rtmToken: "006da47445f83cd4240818abc1686b96f69IADknkDy8C1yjKNYnFKmLrcbcqN9uqvz7l8evnOoizJN+0ejuwwAAAAAEADEZckk9pB1YAEA6AP2kHVg"},
                    {userUuid: "teacher02", rtmToken: "006da47445f83cd4240818abc1686b96f69IAD1WodnJQBupw0ILRRV0mNIhLT+SaBOa9vUUsP4j5mX6P3yspUAAAAAEADEZckk/5B1YAEA6AP/kHVg"},
                    {userUuid: "teacher03", rtmToken: "006da47445f83cd4240818abc1686b96f69IAAsgjWT7SgsRvofmBYiJVaOQSb8s6NUFJ7AQ18qM8QzxmvCteIAAAAAEADEZckkCZF1YAEA6AMJkXVg"}
                ]

                const idx = document.querySelector('#userPicker').value

                let teacher = teachers[idx]

                if(!roomUuid || !teacher) {
                    alert(`info missing`)
                } else {
                    const callback = (cachePath) => {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        appId: "da47445f83cd4240818abc1686b96f69",
                        options: {
                            userUuid: teacher.userUuid,
                            rtmToken: teacher.rtmToken,
                            rtmUid: teacher.userUuid,
                            userName: "MOCK_TA",
                            roomUuid: roomUuid,
                            roomName: roomUuid,
                            language: "zh",
                            roleType:1,
                            roomType:0,
                            startTime: new Date().getTime(),
                            translateLanguage: "auto",
                            courseWareList,
                            duration: 1500,
                            pretest: true
                        },
                        cachePath
                    }), '*')
                }
                window.getCachePath ? window.getCachePath(callback) : callback(undefined)
                }

                
                window.addEventListener('message', function(e) {
                    let data = JSON.parse(e.data)
                    let classevent = data.classevent || {}
                    let {evt, args} = classevent
                    if(evt === 3) {
                        if(args.name === "sos") {
                            alert('sos clicked')
                        }
                    } else if(evt === 2) {
                        alert('destroyed')
                    }
                })
            }
        }
        
    </script>
    <select id="userPicker">
        <option value="0">teacher01</option>
        <option value="1">teacher02</option>
        <option value="2">teacher03</option>
    </select>
    <input id="roomUuid" placeholder="roomUuid"></input>
    <button id="btn">test</button>
    <iframe style="width:100%;height:100%;border:0;" allow="camera;microphone" frameBorder="0" id="agoraproxy" src="https://solutions.agoralab.co/acadsoc/1.1.0/app/classroom.html"></iframe>
</body>
</html>
